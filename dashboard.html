<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - QubeNode Validator</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { background: #000; color: #fff; font-family: 'Space Grotesk', sans-serif; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        .back-button { background: linear-gradient(135deg, #00D4FF, #00FFF0); border: none; color: #000; padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; transition: all 0.3s; }
        .disconnect-btn { background: rgba(239, 68, 68, 0.2); border: 2px solid rgba(239, 68, 68, 0.4); color: #ef4444; padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .disconnect-btn:hover { background: rgba(239, 68, 68, 0.3); }
        
        .page-title { color: #00FFF0; font-size: 2em; font-weight: 700; text-align: center; margin-bottom: 20px; }
        
        .wallet-info { background: rgba(0, 212, 255, 0.1); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 15px; padding: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .wallet-address { color: #00D4FF; font-size: 1.1em; font-weight: 600; word-break: break-all; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(0, 212, 255, 0.05)); border: 2px solid rgba(0, 212, 255, 0.4); border-radius: 12px; padding: 15px; text-align: center; }
        .stat-card.green { background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05)); border-color: rgba(34, 197, 94, 0.4); }
        .stat-card.red { background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border-color: rgba(239, 68, 68, 0.4); }
        .stat-label { color: #94a3b8; font-size: 0.8em; margin-bottom: 8px; text-transform: uppercase; }
        .stat-value { font-size: 1.6em; font-weight: 700; margin-bottom: 3px; }
        .stat-value.blue { color: #00D4FF; }
        .stat-value.green { color: #22c55e; }
        .stat-value.red { color: #ef4444; }
        .stat-subvalue { color: #64748b; font-size: 0.8em; }
        
        .section { background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 18px; margin-bottom: 20px; }
        .section-title { color: #00FFF0; font-size: 1.1em; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        
        .forecast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; }
        .forecast-card { background: linear-gradient(135deg, rgba(34, 197, 94, 0.12), rgba(34, 197, 94, 0.04)); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 12px; text-align: center; }
        .forecast-label { color: #86efac; font-size: 0.75em; margin-bottom: 6px; font-weight: 600; }
        .forecast-value { color: #4ade80; font-size: 1.2em; font-weight: 700; }
        
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { flex: 1; min-width: 200px; padding: 14px 20px; border-radius: 10px; font-size: 1em; font-weight: 700; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; border: none; }
        .btn-primary { background: linear-gradient(135deg, #00D4FF, #00FFF0); color: #000; }
        .btn-secondary { background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1)); border: 2px solid rgba(34, 197, 94, 0.4); color: #22c55e; }
        .btn:hover { transform: translateY(-2px); }
        
        .delegation-list { display: flex; flex-direction: column; gap: 12px; }
        .delegation-item { background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 12px; padding: 15px; }
        .delegation-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        .validator-name { color: #00FFF0; font-weight: 600; font-size: 0.9em; }
        .delegation-amount { color: #22c55e; font-size: 1.2em; font-weight: 700; }
        .delegation-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .delegation-actions button { padding: 8px 16px; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-stake { background: rgba(0, 212, 255, 0.2); border: 1px solid rgba(0, 212, 255, 0.4); color: #00D4FF; }
        .btn-claim { background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); color: #22c55e; }
        .btn-unbond { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); color: #ef4444; }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .btn { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-button">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É</a>
            <button class="disconnect-btn" onclick="disconnectWallet()">–í—ñ–¥–∫–ª—é—á–∏—Ç–∏</button>
        </div>
        
        <h1 class="page-title">üíé –î–∞—à–±–æ—Ä–¥ –î–µ–ª–µ–≥–∞—Ç–æ—Ä–∞</h1>
        <p style="text-align: center; color: #94a3b8; margin-bottom: 20px;">–ö–µ—Ä—É–π—Ç–µ —Å–≤–æ—ó–º —Å—Ç–µ–π–∫—ñ–Ω–≥–æ–º</p>
        
        <div class="wallet-info">
            <div>
                <div style="color: #94a3b8; font-size: 0.85em; margin-bottom: 4px;">–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ:</div>
                <div class="wallet-address" id="walletAddress">--</div>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">üí∞ –ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value blue" id="dashBalance">0.000</div>
                <div class="stat-subvalue">TICS</div>
            </div>
            <div class="stat-card green">
                <div class="stat-label">ü§ù –î–µ–ª–µ–≥–æ–≤–∞–Ω–æ</div>
                <div class="stat-value green" id="dashDelegated">0.000</div>
                <div class="stat-subvalue">TICS</div>
            </div>
            <div class="stat-card green">
                <div class="stat-label">‚ú® –í–∏–Ω–∞–≥–æ—Ä–æ–¥–∏</div>
                <div class="stat-value green" id="dashRewards">0.000</div>
                <div class="stat-subvalue">TICS</div>
            </div>
            <div class="stat-card red">
                <div class="stat-label">‚è≥ Unbonding</div>
                <div class="stat-value red" id="dashUnbonding">0.000</div>
                <div class="stat-subvalue">TICS (14 –¥–Ω—ñ–≤)</div>
            </div>
        </div>
        
        <!-- Forecast -->
        <div class="section">
            <h4 class="section-title"><span>üìà</span><span>–ü—Ä–æ–≥–Ω–æ–∑ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥</span></h4>
            <div class="forecast-grid">
                <div class="forecast-card">
                    <div class="forecast-label">–ù–∞ –¥–µ–Ω—å</div>
                    <div class="forecast-value"><span id="forecastDaily">0.000</span> TICS</div>
                </div>
                <div class="forecast-card">
                    <div class="forecast-label">–ù–∞ —Ç–∏–∂–¥–µ–Ω—å</div>
                    <div class="forecast-value"><span id="forecastWeekly">0.000</span> TICS</div>
                </div>
                <div class="forecast-card">
                    <div class="forecast-label">–ù–∞ –º—ñ—Å—è—Ü—å</div>
                    <div class="forecast-value"><span id="forecastMonthly">0.000</span> TICS</div>
                </div>
                <div class="forecast-card">
                    <div class="forecast-label">–ù–∞ —Ä—ñ–∫</div>
                    <div class="forecast-value"><span id="forecastYearly">0.000</span> TICS</div>
                </div>
            </div>
            <p style="color: #64748b; font-size: 0.75em; margin-top: 10px; text-align: center;">* APY ~30%, –∫–æ–º—ñ—Å—ñ—è –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä–∞ –≤–∂–µ –≤—Ä–∞—Ö–æ–≤–∞–Ω–∞</p>
        </div>
        
        <!-- Quick Actions -->
        <div class="section" style="background: rgba(0, 212, 255, 0.08); border: 2px solid rgba(0, 212, 255, 0.3);">
            <h4 class="section-title"><span>üíé</span><span>–®–≤–∏–¥–∫—ñ –¥—ñ—ó</span></h4>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="quickStakeToQubeNode()">
                    <span>üöÄ</span><span>–î–µ–ª–µ–≥—É–≤–∞—Ç–∏ –¥–æ QubeNode</span>
                </button>
                <button class="btn btn-secondary" onclick="quickClaimAll()">
                    <span>üí∞</span><span>–ó—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏</span>
                </button>
            </div>
        </div>
        
        <!-- My Delegations -->
        <div class="section">
            <h4 class="section-title"><span>üìã</span><span>–ú–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó</span></h4>
            <div class="delegation-list" id="delegationsList">
                <div style="text-align: center; color: #64748b; padding: 20px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ü—ñ–π...</div>
            </div>
        </div>
        
        <!-- Unbonding Delegations -->
        <div class="section" id="unbondingSection" style="display: none;">
            <h4 class="section-title"><span>‚è≥</span><span>Unbonding (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 14 –¥–Ω—ñ–≤)</span></h4>
            <div class="delegation-list" id="unbondingList">
                <div style="text-align: center; color: #64748b; padding: 20px;">–ù–µ–º–∞—î unbonding –¥–µ–ª–µ–≥–∞—Ü—ñ–π</div>
            </div>
        </div>
    </div>
    
    <script>
        const QUBENODE_VALIDATOR = 'qubeticsvaloper1tzk9f84cv2gmk3du3m9dpxcuph70sfj6uf6kld';
        
        let cosmosStaking = null;
        let validatorNamesCache = {};
        
        async function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const wallet = urlParams.get('wallet');
            const address = urlParams.get('address');
            
            if (!wallet || !address) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å');
                window.location.href = 'how-to-delegate.html';
                return;
            }
            
            document.getElementById('walletAddress').textContent = address;
            
            // Wait for cosmos modules to load
            await waitForModules();
            
            // Initialize staking
            cosmosStaking = new CosmosStakingModule();
            await cosmosStaking.initialize();
            
            // Connect wallet
            const result = await cosmosStaking.connectWallet(wallet);
            
            if (result.success) {
                await loadData();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è');
                window.location.href = 'how-to-delegate.html';
            }
        }
        
        async function waitForModules() {
            return new Promise((resolve) => {
                const check = setInterval(() => {
                    if (typeof CosmosStakingModule !== 'undefined') {
                        clearInterval(check);
                        resolve();
                    }
                }, 100);
            });
        }
        
        async function loadData() {
            try {
                const overview = await cosmosStaking.refresh();
                
                // Update stats
                document.getElementById('dashBalance').textContent = formatTics(overview.balance);
                document.getElementById('dashDelegated').textContent = formatTics(overview.totalDelegated);
                document.getElementById('dashRewards').textContent = formatTics(overview.totalRewards);
                document.getElementById('dashUnbonding').textContent = formatTics(overview.totalUnbonding);
                
                // Calculate forecast
                const delegated = parseFloat(overview.totalDelegated) / 1e18;
                const apy = 0.285; // 28.5% after 5% commission
                
                const daily = (delegated * apy) / 365;
                const weekly = daily * 7;
                const monthly = daily * 30;
                const yearly = delegated * apy;
                
                document.getElementById('forecastDaily').textContent = daily.toFixed(3);
                document.getElementById('forecastWeekly').textContent = weekly.toFixed(3);
                document.getElementById('forecastMonthly').textContent = monthly.toFixed(3);
                document.getElementById('forecastYearly').textContent = yearly.toFixed(3);
                
                // Load delegations
                await loadDelegations(overview);
                
                // Load unbonding delegations
                await loadUnbonding(overview);
                
            } catch (error) {
                console.error('Error loading data:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: ' + error.message);
            }
        }
        
        async function loadDelegations(overview) {
            const container = document.getElementById('delegationsList');
            
            if (!overview.delegations || overview.delegations.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px;">–î–µ–ª–µ–≥–∞—Ü—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }
            
            let html = '';
            
            for (const del of overview.delegations) {
                const valAddr = del.delegation.validator_address;
                const amount = formatTics(del.balance.amount);
                
                // Get validator name
                let valName = validatorNamesCache[valAddr] || '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                if (!validatorNamesCache[valAddr]) {
                    loadValidatorName(valAddr);
                }
                
                // Get rewards for this validator
                let rewards = '0.000';
                if (overview.rewards && overview.rewards.rewards) {
                    const rewardEntry = overview.rewards.rewards.find(r => r.validator_address === valAddr);
                    if (rewardEntry && rewardEntry.reward && rewardEntry.reward.length > 0) {
                        const ticsReward = rewardEntry.reward.find(r => r.denom === 'tics');
                        if (ticsReward) {
                            rewards = formatTics(ticsReward.amount);
                        }
                    }
                }
                
                html += `
                    <div class="delegation-item">
                        <div class="delegation-header">
                            <div>
                                <div class="validator-name">${valName}</div>
                                <div style="color: #64748b; font-size: 0.75em; margin-top: 4px;">${valAddr.substring(0, 20)}...</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="delegation-amount">${amount} TICS</div>
                                <div style="color: #86efac; font-size: 0.85em; margin-top: 4px;">Rewards: ${rewards} TICS</div>
                            </div>
                        </div>
                        <div class="delegation-actions">
                            <button class="btn-stake" onclick="stakeMore('${valAddr}')">üíé Stake More</button>
                            <button class="btn-claim" onclick="claimRewards('${valAddr}')">‚ú® Claim</button>
                            <button class="btn-unbond" onclick="unbond('${valAddr}')">‚õî Unbond</button>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        async function loadValidatorName(address) {
            try {
                const response = await fetch(`https://swagger.qubetics.com/cosmos/staking/v1beta1/validators/${address}`);
                const data = await response.json();
                if (data.validator && data.validator.description) {
                    validatorNamesCache[address] = data.validator.description.moniker || address;
                    await loadData(); // Refresh to show name
                }
            } catch (error) {
                console.error('Error loading validator name:', error);
            }
        }
        
        function formatTics(amount) {
            if (!amount) return '0.000';
            const tics = parseFloat(amount) / 1e18;
            return tics.toFixed(3);
        }
        
        async function quickStakeToQubeNode() {
            const amount = prompt('–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å TICS –¥–ª—è –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è:');
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                return;
            }
            
            try {
                const result = await cosmosStaking.delegate(parseFloat(amount), 'Delegation via QubeNode.space');
                alert('‚úÖ –î–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function quickClaimAll() {
            try {
                const result = await cosmosStaking.claimRewards('Claim all via QubeNode.space');
                alert('‚úÖ –í–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –∑—ñ–±—Ä–∞–Ω–æ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function stakeMore(validatorAddress) {
            const amount = prompt('–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å TICS:');
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                return;
            }
            
            try {
                const amountMinimal = (parseFloat(amount) * 1e18).toString();
                
                // Use CosmosStakingService directly with specific validator
                const walletManager = cosmosStaking.walletManager;
                const chainClient = cosmosStaking.chainClient;
                const txBuilder = cosmosStaking.txBuilder;
                
                const stakingService = new CosmosStakingService(walletManager, chainClient, txBuilder);
                const result = await stakingService.delegate(validatorAddress, amountMinimal, 'Stake more via QubeNode.space');
                
                alert('‚úÖ –£—Å–ø—ñ—à–Ω–æ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                console.error('Stake error:', error);
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function claimRewards(validatorAddress) {
            try {
                // Use CosmosStakingService directly with specific validator
                const walletManager = cosmosStaking.walletManager;
                const chainClient = cosmosStaking.chainClient;
                const txBuilder = cosmosStaking.txBuilder;
                
                const stakingService = new CosmosStakingService(walletManager, chainClient, txBuilder);
                const result = await stakingService.claimRewards(validatorAddress, 'Claim via QubeNode.space');
                
                alert('‚úÖ –í–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –∑—ñ–±—Ä–∞–Ω–æ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                console.error('Claim error:', error);
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function unbond(validatorAddress) {
            const amount = prompt('–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å TICS –¥–ª—è unbond (–ø–µ—Ä—ñ–æ–¥ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 14 –¥–Ω—ñ–≤):');
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                return;
            }
            
            if (!confirm(`–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ ${amount} TICS? –û—á—ñ–∫—É–≤–∞–Ω–Ω—è: 14 –¥–Ω—ñ–≤`)) {
                return;
            }
            
            try {
                const amountMinimal = (parseFloat(amount) * 1e18).toString();
                
                // Use CosmosStakingService directly with specific validator
                const walletManager = cosmosStaking.walletManager;
                const chainClient = cosmosStaking.chainClient;
                const txBuilder = cosmosStaking.txBuilder;
                
                const stakingService = new CosmosStakingService(walletManager, chainClient, txBuilder);
                const result = await stakingService.undelegate(validatorAddress, amountMinimal, 'Unbond via QubeNode.space');
                
                alert('‚úÖ Unbond —Ä–æ–∑–ø–æ—á–∞—Ç–æ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                console.error('Unbond error:', error);
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function cancelUnbonding(validatorAddress, amount, creationHeight) {
            if (!confirm(`–°–∫–∞—Å—É–≤–∞—Ç–∏ unbond ${formatTics(amount)} TICS? –¢–æ–∫–µ–Ω–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–µ–ª–µ–≥–∞—Ü—ñ—é.`)) {
                return;
            }
            
            try {
                // Use CosmosStakingService directly
                const walletManager = cosmosStaking.walletManager;
                const chainClient = cosmosStaking.chainClient;
                const txBuilder = cosmosStaking.txBuilder;
                
                const stakingService = new CosmosStakingService(walletManager, chainClient, txBuilder);
                const result = await stakingService.cancelUnbonding(
                    validatorAddress, 
                    amount, 
                    creationHeight, 
                    'Cancel unbond via QubeNode.space'
                );
                
                alert('‚úÖ Unbond —Å–∫–∞—Å–æ–≤–∞–Ω–æ! TX: ' + result.txHash);
                await loadData();
            } catch (error) {
                console.error('Cancel unbonding error:', error);
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        }
        
        async function loadUnbonding(overview) {
            const section = document.getElementById('unbondingSection');
            const container = document.getElementById('unbondingList');
            
            if (!overview.unbondingDelegations || overview.unbondingDelegations.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            let html = '';
            
            for (const unbonding of overview.unbondingDelegations) {
                const valAddr = unbonding.validator_address;
                
                // Get validator name
                let valName = validatorNamesCache[valAddr] || '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                if (!validatorNamesCache[valAddr]) {
                    loadValidatorName(valAddr);
                }
                
                // Process entries
                for (const entry of unbonding.entries) {
                    const amount = formatTics(entry.balance);
                    const completionTime = new Date(entry.completion_time);
                    const now = new Date();
                    const daysLeft = Math.ceil((completionTime - now) / (1000 * 60 * 60 * 24));
                    const creationHeight = entry.creation_height || entry.initial_balance; // Fallback
                    
                    html += `
                        <div class="delegation-item" style="background: rgba(239, 68, 68, 0.05); border-color: rgba(239, 68, 68, 0.2);">
                            <div class="delegation-header">
                                <div>
                                    <div class="validator-name" style="color: #ef4444;">${valName}</div>
                                    <div style="color: #64748b; font-size: 0.75em; margin-top: 4px;">${valAddr.substring(0, 20)}...</div>
                                </div>
                                <div style="text-align: right;">
                                    <div class="delegation-amount" style="color: #ef4444;">${amount} TICS</div>
                                    <div style="color: #fca5a5; font-size: 0.85em; margin-top: 4px;">
                                        ${daysLeft > 0 ? `‚è≥ ${daysLeft} –¥–Ω—ñ–≤` : '‚úÖ –ì–æ—Ç–æ–≤–æ'}
                                    </div>
                                </div>
                            </div>
                            <div style="color: #94a3b8; font-size: 0.8em; margin-top: 8px;">
                                –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è: ${completionTime.toLocaleDateString('uk-UA')} ${completionTime.toLocaleTimeString('uk-UA')}
                            </div>
                            ${daysLeft > 0 ? `
                            <div style="margin-top: 12px;">
                                <button onclick="cancelUnbonding('${valAddr}', '${entry.balance}', '${creationHeight}')" 
                                        style="padding: 8px 16px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; color: #ef4444; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">
                                    ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏ Unbond
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html;
        }
        
        function disconnectWallet() {
            if (confirm('–í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≥–∞–º–∞–Ω–µ—Ü—å?')) {
                window.location.href = 'index.html';
            }
        }
        
        // Initialize on load
        window.addEventListener('load', init);
    </script>
    
    <!-- Cosmos Modules -->
    <script src="chain-config.js"></script>
    <script src="wallet-manager.js"></script>
    <script src="chain-client.js"></script>
    <script src="transaction-builder.js"></script>
    <script src="staking-service.js"></script>
    <script src="cosmos-staking.js"></script>
</body>
</html>
